!function(d){"use strict";d.fn.timeSchedule=function(i){var p=d.extend({className:"jq-schedule",rows:{},startTime:"07:00",endTime:"19:30",widthTimeX:25,widthTime:600,timeLineY:50,timeLineBorder:1,timeBorder:1,timeLinePaddingTop:0,timeLinePaddingBottom:0,headTimeBorder:1,dataWidth:160,verticalScrollbar:0,bundleMoveWidth:1,init_data:null,change:null,click:null,append:null,time_click:null,debug:""},i);this.setting=p;var u=new Array,v=new Array,T=d(this),w=this,l=null,_=0,g=0;return this.calcStringTime=function(i){var e=i.split(":");return 60*Number(e[0])*60+60*Number(e[1])},this.formatTime=function(i){return""+(i/36e3|0)+(i/3600%10|0)+":"+(""+(i%3600/600|0)+(i%3600/60%10|0))},this.getScheduleData=function(){return u},this.getTimelineData=function(){return v},this.getTimeLineNumber=function(i){var e=0,t=0,n=Math.ceil(i/(p.timeLineY+p.timeLinePaddingTop+p.timeLinePaddingBottom));for(var a in p.rows){var s=p.rows[a],d=0;if(typeof s.schedule===Object&&(d=s.schedule.length),l&&l.timeline&&d++,n<=(t+=Math.max(d,1)))break;e++}return e},this.addScheduleBgData=function(i){var e=Math.ceil((i.start-_)/p.widthTime),t=Math.floor((i.end-_)/p.widthTime),n=jQuery('<div class="sc_bgBar"><span class="text"></span></div>');w.formatTime(i.start),w.formatTime(i.end),w.getScheduleCount(i.timeline);n.css({left:e*p.widthTimeX,top:0,width:(t-e)*p.widthTimeX,height:T.find(".sc_main .timeline").eq(i.timeline).height()}),i.text&&n.find(".text").text(i.text),i.class&&n.addClass(i.class),T.find(".sc_main .timeline").eq(i.timeline).append(n)},this.addScheduleData=function(i){var e=Math.ceil((i.start-_)/p.widthTime),t=Math.floor((i.end-_)/p.widthTime),n=jQuery('<div class="sc_bar"><span class="head"><span class="time"></span></span><span class="text"></span></div>'),a=w.formatTime(i.start),s=w.formatTime(i.end),d=w.getScheduleCount(i.timeline);n.css({left:e*p.widthTimeX,top:d*p.timeLineY+p.timeLinePaddingTop,width:(t-e)*p.widthTimeX,height:p.timeLineY}),n.find(".time").text(a+"-"+s),i.text&&n.find(".text").text(i.text),i.class&&n.addClass(i.class),T.find(".sc_main .timeline").eq(i.timeline).append(n),u.push(i);var r=u.length-1;n.data("sc_key",r),n.bind("mouseup",function(){if(p.click&&!0!==jQuery(this).data("dragCheck")&&!0!==jQuery(this).data("resizeCheck")){var i=jQuery(this),e=i.data("sc_key");p.click(i,u[e])}});var o=T.find(".sc_bar");return o.draggable({grid:[p.widthTimeX,1],containment:".sc_main",helper:"original",start:function(i,e){var t={};t.node=this,t.offsetTop=e.position.top,t.offsetLeft=e.position.left,t.currentTop=e.position.top,t.currentLeft=e.position.left,t.timeline=w.getTimeLineNumber(e.position.top),t.nowTimeline=t.timeline,l=t},drag:function(i,e){if(jQuery(this).data("dragCheck",!0),!l)return!1;var t=jQuery(this),n=t.data("sc_key"),a=(e.originalPosition.top,e.originalPosition.left,e.position.top,e.position.left,w.getTimeLineNumber(e.position.top));return e.position.left=Math.floor(e.position.left/p.widthTimeX)*p.widthTimeX,l.nowTimeline!==a&&(l.nowTimeline=a),l.currentTop=e.position.top,l.currentLeft=e.position.left,w.rewriteBarText(t,u[n]),!0},stop:function(i,e){jQuery(this).data("dragCheck",!1),l=null;var t=jQuery(this),n=t.data("sc_key"),a=t.position().left,s=(t.width(),_+Math.floor(a/p.widthTimeX)*p.widthTime),d=s+(u[n].end-u[n].start);u[n].start=s,u[n].end=d,p.change&&p.change(t,u[n])}}),o.resizable({handles:"e",grid:[p.widthTimeX,p.timeLineY],minWidth:p.widthTimeX,start:function(i,e){jQuery(this).data("resizeCheck",!0)},stop:function(i,e){var t=jQuery(this),n=t.data("sc_key"),a=t.position().left,s=t.width(),d=_+Math.floor(a/p.widthTimeX)*p.widthTime,r=_+Math.floor((a+s)/p.widthTimeX)*p.widthTime,o=u[n].timeline;u[n].start=d,u[n].end=r,w.resetBarPosition(o),w.rewriteBarText(t,u[n]),t.data("resizeCheck",!1),p.change&&p.change(t,u[n])}}),r},this.getScheduleCount=function(i){var e=0;for(var t in u)u[t].timeline===i&&e++;return e},this.addRow=function(i,e){var t,n=e.title,a=T.find(".sc_main .timeline").length;t="",t+='<div class="timeline"><span>'+n+"</span></div>";var s=jQuery(t);p.init_data&&p.init_data(s,e),T.find(".sc_data_scroll").append(s),t="",t+='<div class="timeline"></div>';for(var d=jQuery(t),r=_;r<g;r+=p.widthTime){var o=jQuery('<div class="tl"></div>');o.width(p.widthTimeX-p.timeBorder),o.data("time",w.formatTime(r)),o.data("timeline",i),d.append(o)}if(d.find(".tl").click(function(){w.moveSchedules(jQuery(this).data("timeline"),jQuery(this),p.bundleMoveWidth),p.time_click&&p.time_click(this,jQuery(this).data("time"),jQuery(this).data("timeline"),v[jQuery(this).data("timeline")])}),d.find(".tl").on("contextmenu",function(i){return w.moveSchedules(jQuery(this).data("timeline"),jQuery(this),-1*p.bundleMoveWidth),p.time_click&&p.time_click(this,jQuery(this).data("time"),jQuery(this).data("timeline"),v[jQuery(this).data("timeline")]),!1}),T.find(".sc_main").append(d),(v[i]=e).class&&""!=e.class&&(T.find(".sc_data .timeline").eq(a).addClass(e.class),T.find(".sc_main .timeline").eq(a).addClass(e.class)),e.schedule)for(var l in e.schedule){var c=e.schedule[l],h=w.calcStringTime(c.start),m=w.calcStringTime(c.end),f={};f.timeline=a,f.start=h,f.end=m,c.text&&(f.text=c.text),f.data={},c.data&&(f.data=c.data),w.addScheduleData(f)}w.resetBarPosition(a),T.find(".sc_main .timeline").eq(a).droppable({accept:".sc_bar",drop:function(i,e){var t=e.draggable,n=t.data("sc_key"),a=u[n].timeline,s=T.find(".sc_main .timeline").index(this);u[n].timeline=s,t.appendTo(this),w.resetBarPosition(a),w.resetBarPosition(s)}}),p.append&&T.find(".sc_main .timeline").eq(a).find(".sc_bar").each(function(){var i=jQuery(this),e=i.data("sc_key");p.append(i,u[e])})},this.getScheduleData=function(){var i=new Array;for(var e in v)if(void 0!==v[e]){var t=jQuery.extend(!0,{},v[e]);t.schedule=new Array,i.push(t)}for(var e in u)if(void 0!==u[e]){var n=jQuery.extend(!0,{},u[e]);n.start=this.formatTime(n.start),n.end=this.formatTime(n.end);var a=n.timeline;delete n.timeline,i[a].schedule.push(n)}return i},this.rewriteBarText=function(i,e){var t=i.position().left,n=(i.width(),_+Math.floor(t/p.widthTimeX)*p.widthTime),a=n+(e.end-e.start),s=w.formatTime(n)+"-"+w.formatTime(a);jQuery(i).find(".time").html(s)},this.resetBarPosition=function(i){for(var e=T.find(".sc_main .timeline").eq(i).find(".sc_bar"),t=[],n=0;n<e.length;n++)t[n]={code:n,x:jQuery(e[n]).position().left};t.sort(function(i,e){return i.x<e.x?-1:i.x>e.x?1:0});var a,s,d,r,o,l,c,h=[],m=0;for(n=0;n<t.length;n++){for(d=t[n].code,a=jQuery(e[d]),m=0;m<h.length;m++){for(var f=!1,u=0;u<h[m].length;u++)r=h[m][u],s=jQuery(e[r]),o=a.position().left,l=a.position().left+a.width(),c=s.position().left,o<s.position().left+s.width()&&c<l&&(f=!0);if(!f)break}h[m]||(h[m]=[]),a.css({top:m*p.timeLineY+p.timeLinePaddingTop}),h[m][h[m].length]=d}this.resizeRow(i,h.length)},this.resizeRow=function(i,e){var t=Math.max(e,1);T.find(".sc_data .timeline").eq(i).height(t*p.timeLineY-p.timeLineBorder+p.timeLinePaddingTop+p.timeLinePaddingBottom),T.find(".sc_main .timeline").eq(i).height(t*p.timeLineY-p.timeLineBorder+p.timeLinePaddingTop+p.timeLinePaddingBottom),T.find(".sc_main .timeline").eq(i).find(".sc_bgBar").each(function(){jQuery(this).height(jQuery(this).closest(".timeline").height())}),T.find(".sc_data").height(T.find(".sc_main_box").height())},this.resizeWindow=function(){var i=T.width()-p.dataWidth-p.verticalScrollbar,e=Math.floor((g-_)/p.widthTime);T.find(".sc_header_cell").width(p.dataWidth),T.find(".sc_data,.sc_data_scroll").width(p.dataWidth),T.find(".sc_header").width(i),T.find(".sc_main_box").width(i),T.find(".sc_header_scroll").width(p.widthTimeX*e),T.find(".sc_main_scroll").width(p.widthTimeX*e)},this.moveSchedules=function(i,e,t){for(var n=T.find(".sc_main .timeline").eq(i).find(".sc_bar"),a=0;a<n.length;a++){var s=jQuery(n[a]);if(e.position().left<=s.position().left){s.css({left:Math.max(0,Math.min(s.position().left+p.widthTimeX*t,Math.floor((g-_)/p.widthTime)*p.widthTimeX-s.width()))});var d=s.data("sc_key"),r=_+Math.floor(s.position().left/p.widthTimeX)*p.widthTime,o=r+(u[d].end-u[d].start);u[d].start=r,u[d].end=o,w.rewriteBarText(s,u[d]),p.change&&p.change(s,u[d])}}w.resetBarPosition(i)},this.init=function(){_=w.calcStringTime(p.startTime),g=w.calcStringTime(p.endTime),_-=_%p.widthTime,g-=g%p.widthTime;var i="";i+='<div class="sc_menu">\n',i+='<div class="sc_header_cell"><span>&nbsp;</span></div>\n',i+='<div class="sc_header">\n',i+='<div class="sc_header_scroll">\n',i+="</div>\n",i+="</div>\n",i+='<br class="clear" />\n',i+="</div>\n",i+='<div class="sc_wrapper">\n',i+='<div class="sc_data">\n',i+='<div class="sc_data_scroll">\n',i+="</div>\n",i+="</div>\n",i+='<div class="sc_main_box">\n',i+='<div class="sc_main_scroll">\n',i+='<div class="sc_main">\n',i+="</div>\n",i+="</div>\n",i+="</div>\n",i+='<br class="clear" />\n',i+="</div>\n",T.append(i),T.addClass(p.className),T.find(".sc_main_box").scroll(function(){T.find(".sc_data_scroll").css("top",-1*d(this).scrollTop()),T.find(".sc_header_scroll").css("left",-1*d(this).scrollLeft())});for(var e=-1,t=_;t<g;t+=p.widthTime)if(e<0||Math.floor(e/3600)!==Math.floor(t/3600)){i="";i+='<div class="sc_time">'+w.formatTime(t)+"</div>";var n=jQuery(i),a=Math.floor(Number(Math.min(3600*Math.ceil((t+p.widthTime)/3600),g)-t)/p.widthTime);n.width(a*p.widthTimeX-p.headTimeBorder),T.find(".sc_header_scroll").append(n),e=t}for(var s in jQuery(window).resize(function(){w.resizeWindow()}).trigger("resize"),p.rows)this.addRow(s,p.rows[s])},this.init(),this.debug=function(){var i="";for(var e in u){i+="<div>",i+=e+" : ";var t=u[e];for(var n in t){i+=n+" "+t[n]}i+="</div>"}jQuery(p.debug).html(i)},p.debug&&""!==p.debug&&setInterval(function(){w.debug()},10),this}}(jQuery);
//# sourceMappingURL=jq.schedule.min.js.map
