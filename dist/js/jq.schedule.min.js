!function(u){"use strict";var _,p,v=null,w=[],g=[],c=null,T=0,b=0,x={calcStringTime:function(i){var e=i.split(":");return 60*Number(e[0])*60+60*Number(e[1])},formatTime:function(i){return""+(i/36e3|0)+(i/3600%10|0)+":"+(""+(i%3600/600|0)+(i%3600/60%10|0))},scheduleData:function(){return w},timelineData:function(){var i,e=[];for(i in g)e[i]=g[i],e[i].schedule=[];for(i in w){var t=w[i];void 0!==t.timeline&&void 0!==e[t.timeline]&&e[t.timeline].schedule.push(t)}return e},resetData:function(){for(var i in w=[],_.find(".sc_bar").remove(),g)g[i].schedule=[],x._resizeRow.apply(this,[i,0]);return this},addSchedule:function(i,e){var t={start:x.calcStringTime(e.start),end:x.calcStringTime(e.end),text:e.text,timeline:i};return e.data&&(t.data=e.data),x._addScheduleData.apply(this,[i,t]),x._resetBarPosition.apply(this,[i]),this},setDraggable:function(i){var e=!!i;e!==v.draggable&&((v.draggable=e)?_.find(".sc_bar").draggable("enable"):_.find(".sc_bar").draggable("disable"))},setResizable:function(i){var e=!!i;e!==v.resizable&&((v.resizable=e)?_.find(".sc_bar").resizable("enable"):_.find(".sc_bar").resizable("disable"))},_getTimeLineNumber:function(i){var e=0,t=0,a=Math.ceil(i/(v.timeLineY+v.timeLinePaddingTop+v.timeLinePaddingBottom));for(var n in v.rows){var d=v.rows[n],s=0;if("object"==typeof d.schedule&&(s=d.schedule.length),c&&c.timeline&&s++,a<=(t+=Math.max(s,1)))break;e++}return e},_addScheduleBgData:function(i){var e=Math.ceil((i.start-T)/v.widthTime),t=Math.floor((i.end-T)/v.widthTime),a=u('<div class="sc_bgBar"><span class="text"></span></div>');a.css({left:e*v.widthTimeX,top:0,width:(t-e)*v.widthTimeX,height:_.find(".sc_main .timeline").eq(i.timeline).height()}),i.text&&a.find(".text").text(i.text),i.class&&a.addClass(i.class),_.find(".sc_main .timeline").eq(i.timeline).append(a)},_addScheduleData:function(i,e){var t=Math.ceil((e.start-T)/v.widthTime),a=Math.floor((e.end-T)/v.widthTime),n=u('<div class="sc_bar"><span class="head"><span class="time"></span></span><span class="text"></span></div>'),d=x.formatTime(e.start),s=x.formatTime(e.end),r=x._getScheduleCount.apply(p,[e.timeline]);n.css({left:t*v.widthTimeX,top:r*v.timeLineY+v.timeLinePaddingTop,width:(a-t)*v.widthTimeX,height:v.timeLineY}),n.find(".time").text(d+"-"+s),e.text&&n.find(".text").text(e.text),e.class&&n.addClass(e.class),_.find(".sc_main .timeline").eq(i).append(n),w.push(e),v.onAppendSchedule&&v.onAppendSchedule(n,e);var l=w.length-1;n.data("sc_key",l),n.bind("mouseup",function(){if(v.onClick&&!0!==u(this).data("dragCheck")&&!0!==u(this).data("resizeCheck")){var i=u(this),e=i.data("sc_key");v.onClick(i,w[e])}});var o=_.find(".sc_bar");return o.draggable({grid:[v.widthTimeX,1],containment:".sc_main",helper:"original",start:function(i,e){var t={};t.node=this,t.offsetTop=e.position.top,t.offsetLeft=e.position.left,t.currentTop=e.position.top,t.currentLeft=e.position.left,t.timeline=x._getTimeLineNumber.apply(p,[e.position.top]),t.nowTimeline=t.timeline,c=t},drag:function(i,e){if(u(this).data("dragCheck",!0),!c)return!1;var t=u(this),a=t.data("sc_key"),n=x._getTimeLineNumber.apply(p,[e.position.top]);return e.position.left=Math.floor(e.position.left/v.widthTimeX)*v.widthTimeX,c.nowTimeline!==n&&(c.nowTimeline=n),c.currentTop=e.position.top,c.currentLeft=e.position.left,x._rewriteBarText.apply(p,[t,w[a]]),!0},stop:function(){u(this).data("dragCheck",!1),c=null;var i=u(this),e=i.data("sc_key"),t=i.position().left,a=T+Math.floor(t/v.widthTimeX)*v.widthTime,n=a+(w[e].end-w[e].start);w[e].start=a,w[e].end=n,v.onChange&&v.onChange(i,w[e])}}),o.resizable({handles:"e",grid:[v.widthTimeX,v.timeLineY],minWidth:v.widthTimeX,start:function(){u(this).data("resizeCheck",!0)},stop:function(){var i=u(this),e=i.data("sc_key"),t=i.position().left,a=i.width(),n=T+Math.floor(t/v.widthTimeX)*v.widthTime,d=T+Math.floor((t+a)/v.widthTimeX)*v.widthTime,s=w[e].timeline;w[e].start=n,w[e].end=d,x._resetBarPosition.apply(p,[s]),x._rewriteBarText.apply(p,[i,w[e]]),i.data("resizeCheck",!1),v.onChange&&v.onChange(i,w[e])}}),!1===v.draggable&&o.draggable("disable"),!1===v.resizable&&o.resizable("disable"),l},_getScheduleCount:function(i){var e=0;for(var t in w)w[t].timeline===i&&e++;return e},_addRow:function(i,e){var t,a=e.title,n=_.find(".sc_main .timeline").length;t="";var d=u(t+='<div class="timeline"><span>'+a+"</span></div>");v.onInitRow&&v.onInitRow(d,e),_.find(".sc_data_scroll").append(d),t="";for(var s=u(t+='<div class="timeline"></div>'),r=T;r<b;r+=v.widthTime){var l=u('<div class="tl"></div>');l.width(v.widthTimeX-v.timeBorder),l.data("time",x.formatTime(r)),l.data("timeline",i),s.append(l)}if(s.find(".tl").click(function(){v.onScheduleClick&&v.onScheduleClick(this,u(this).data("time"),u(this).data("timeline"),g[u(this).data("timeline")])}),s.find(".tl").on("contextmenu",function(){return v.onScheduleClick&&v.onScheduleClick(this,u(this).data("time"),u(this).data("timeline"),g[u(this).data("timeline")]),!1}),_.find(".sc_main").append(s),(g[i]=e).class&&""!==e.class&&(_.find(".sc_data .timeline").eq(n).addClass(e.class),_.find(".sc_main .timeline").eq(n).addClass(e.class)),e.schedule)for(var o in e.schedule){var c=e.schedule[o],h=x.calcStringTime(c.start),m=x.calcStringTime(c.end),f={};f.start=h,f.end=m,c.text&&(f.text=c.text),f.timeline=o,f.data={},c.data&&(f.data=c.data),x._addScheduleData.apply(p,[n,f])}x._resetBarPosition.apply(p,[n]),_.find(".sc_main .timeline").eq(n).droppable({accept:".sc_bar",drop:function(i,e){var t=e.draggable,a=t.data("sc_key"),n=w[a].timeline,d=_.find(".sc_main .timeline").index(this);w[a].timeline=d,t.appendTo(this),x._resetBarPosition.apply(p,[n]),x._resetBarPosition.apply(p,[d])}}),v.onAppendRow&&_.find(".sc_main .timeline").eq(n).find(".sc_bar").each(function(){var i=u(this),e=i.data("sc_key");v.onAppendRow(i,w[e])})},_rewriteBarText:function(i,e){var t=i.position().left,a=T+Math.floor(t/v.widthTimeX)*v.widthTime,n=a+(e.end-e.start),d=x.formatTime(a)+"-"+x.formatTime(n);u(i).find(".time").html(d)},_resetBarPosition:function(i){var e,t,a,n,d,s,r,l,o=_.find(".sc_main .timeline").eq(i).find(".sc_bar"),c=[],h=[],m=0;for(l=0;l<o.length;l++)c[l]={code:l,x:u(o[l]).position().left};for(c.sort(function(i,e){return i.x<e.x?-1:i.x>e.x?1:0}),l=0;l<c.length;l++){for(a=c[l].code,e=u(o[a]),m=0;m<h.length;m++){for(var f=!1,p=0;p<h[m].length;p++)n=h[m][p],t=u(o[n]),d=e.position().left,r=e.position().left+e.width(),s=t.position().left,d<t.position().left+t.width()&&s<r&&(f=!0);if(!f)break}h[m]||(h[m]=[]),e.css({top:m*v.timeLineY+v.timeLinePaddingTop}),h[m][h[m].length]=a}x._resizeRow.apply(this,[i,h.length])},_resizeRow:function(i,e){var t=Math.max(e,1);_.find(".sc_data .timeline").eq(i).height(t*v.timeLineY-v.timeLineBorder+v.timeLinePaddingTop+v.timeLinePaddingBottom),_.find(".sc_main .timeline").eq(i).height(t*v.timeLineY-v.timeLineBorder+v.timeLinePaddingTop+v.timeLinePaddingBottom),_.find(".sc_main .timeline").eq(i).find(".sc_bgBar").each(function(){u(this).height(u(this).closest(".timeline").height())}),_.find(".sc_data").height(_.find(".sc_main_box").height())},_resizeWindow:function(){var i=_.width()-v.dataWidth-v.verticalScrollbar,e=Math.floor((b-T)/v.widthTime);_.find(".sc_header_cell").width(v.dataWidth),_.find(".sc_data,.sc_data_scroll").width(v.dataWidth),_.find(".sc_header").width(i),_.find(".sc_main_box").width(i),_.find(".sc_header_scroll").width(v.widthTimeX*e),_.find(".sc_main_scroll").width(v.widthTimeX*e)},_moveSchedules:function(i,e,t){for(var a=_.find(".sc_main .timeline").eq(i).find(".sc_bar"),n=0;n<a.length;n++){var d=u(a[n]);if(e.position().left<=d.position().left){var s=d.position().left+v.widthTimeX*t,r=Math.floor((b-T)/v.widthTime)*v.widthTimeX-d.width();d.css({left:Math.max(0,Math.min(s,r))});var l=d.data("sc_key"),o=T+Math.floor(d.position().left/v.widthTimeX)*v.widthTime,c=o+(w[l].end-w[l].start);w[l].start=o,w[l].end=c,x._rewriteBarText.apply(p,[d,w[l]]),v.onChange&&v.onChange(d,w[l])}}x._resetBarPosition.apply(p,[i])},init:function(i){_=u(this),p=this,v=u.extend({className:"jq-schedule",rows:{},startTime:"07:00",endTime:"19:30",widthTimeX:25,widthTime:600,timeLineY:50,timeLineBorder:1,timeBorder:1,timeLinePaddingTop:0,timeLinePaddingBottom:0,headTimeBorder:1,dataWidth:160,verticalScrollbar:0,bundleMoveWidth:1,draggable:!0,resizable:!0,onInitRow:null,onChange:null,onClick:null,onAppendRow:null,onAppendSchedule:null,onScheduleClick:null},i),T=x.calcStringTime(v.startTime),b=x.calcStringTime(v.endTime),T-=T%v.widthTime,b-=b%v.widthTime;var e='<div class="sc_menu">\n<div class="sc_header_cell"><span>&nbsp;</span></div>\n<div class="sc_header">\n<div class="sc_header_scroll"></div>\n</div>\n<br class="clear" />\n</div>\n<div class="sc_wrapper">\n<div class="sc_data">\n<div class="sc_data_scroll"></div>\n</div>\n<div class="sc_main_box">\n<div class="sc_main_scroll">\n<div class="sc_main"></div>\n</div>\n</div>\n<br class="clear" />\n</div>';_.append(e),_.addClass(v.className),_.find(".sc_main_box").scroll(function(){_.find(".sc_data_scroll").css("top",-1*u(this).scrollTop()),_.find(".sc_header_scroll").css("left",-1*u(this).scrollLeft())});for(var t=-1,a=T;a<b;a+=v.widthTime)if(t<0||Math.floor(t/3600)!==Math.floor(a/3600)){e="",e+='<div class="sc_time">'+x.formatTime(a)+"</div>";var n=u(e),d=Number(Math.min(3600*Math.ceil((a+v.widthTime)/3600),b)-a),s=Math.floor(d/v.widthTime);n.width(s*v.widthTimeX-v.headTimeBorder),_.find(".sc_header_scroll").append(n),t=a}for(var r in u(window).resize(function(){x._resizeWindow.apply(p)}).trigger("resize"),v.rows)x._addRow.apply(this,[r,v.rows[r]]);return this}};u.fn.timeSchedule=function(i){return x[i]?x[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(u.error("Method "+i+" does not exist on jQuery.timeSchedule"),this):x.init.apply(this,arguments)}}(jQuery);
//# sourceMappingURL=jq.schedule.min.js.map
