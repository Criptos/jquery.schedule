!function(u){"use strict";var _,p,w=null,v=[],T=[],c=null,g=0,x=0,b={calcStringTime:function(i){var e=i.split(":");return 60*Number(e[0])*60+60*Number(e[1])},formatTime:function(i){return""+(i/36e3|0)+(i/3600%10|0)+":"+(""+(i%3600/600|0)+(i%3600/60%10|0))},scheduleData:function(){return v},timelineData:function(){var i,e=[];for(i in T)e[i]=T[i],e[i].schedule=[];for(i in v){var t=v[i];void 0!==t.timeline&&void 0!==e[t.timeline]&&e[t.timeline].schedule.push(t)}return e},resetData:function(){for(var i in v=[],_.find(".sc_bar").remove(),T)T[i].schedule=[],b._resizeRow.apply(this,[i,0]);return this},addSchedule:function(i,e){var t={start:b.calcStringTime(e.start),end:b.calcStringTime(e.end),text:e.text,timeline:i};return e.data&&(t.data=e.data),b._addScheduleData.apply(this,[i,t]),b._resetBarPosition.apply(this,[i]),this},_getTimeLineNumber:function(i){var e=0,t=0,n=Math.ceil(i/(w.timeLineY+w.timeLinePaddingTop+w.timeLinePaddingBottom));for(var a in w.rows){var d=w.rows[a],s=0;if("object"==typeof d.schedule&&(s=d.schedule.length),c&&c.timeline&&s++,n<=(t+=Math.max(s,1)))break;e++}return e},_addScheduleBgData:function(i){var e=Math.ceil((i.start-g)/w.widthTime),t=Math.floor((i.end-g)/w.widthTime),n=u('<div class="sc_bgBar"><span class="text"></span></div>');n.css({left:e*w.widthTimeX,top:0,width:(t-e)*w.widthTimeX,height:_.find(".sc_main .timeline").eq(i.timeline).height()}),i.text&&n.find(".text").text(i.text),i.class&&n.addClass(i.class),_.find(".sc_main .timeline").eq(i.timeline).append(n)},_addScheduleData:function(i,e){var t=Math.ceil((e.start-g)/w.widthTime),n=Math.floor((e.end-g)/w.widthTime),a=u('<div class="sc_bar"><span class="head"><span class="time"></span></span><span class="text"></span></div>'),d=b.formatTime(e.start),s=b.formatTime(e.end),o=b._getScheduleCount.apply(p,[e.timeline]);a.css({left:t*w.widthTimeX,top:o*w.timeLineY+w.timeLinePaddingTop,width:(n-t)*w.widthTimeX,height:w.timeLineY}),a.find(".time").text(d+"-"+s),e.text&&a.find(".text").text(e.text),e.class&&a.addClass(e.class),_.find(".sc_main .timeline").eq(i).append(a),v.push(e),w.onAppendSchedule&&w.onAppendSchedule(a,e);var r=v.length-1;a.data("sc_key",r),a.bind("mouseup",function(){if(w.onClick&&!0!==u(this).data("dragCheck")&&!0!==u(this).data("resizeCheck")){var i=u(this),e=i.data("sc_key");w.onClick(i,v[e])}});var l=_.find(".sc_bar");return l.draggable({grid:[w.widthTimeX,1],containment:".sc_main",helper:"original",start:function(i,e){var t={};t.node=this,t.offsetTop=e.position.top,t.offsetLeft=e.position.left,t.currentTop=e.position.top,t.currentLeft=e.position.left,t.timeline=b._getTimeLineNumber.apply(p,[e.position.top]),t.nowTimeline=t.timeline,c=t},drag:function(i,e){if(u(this).data("dragCheck",!0),!c)return!1;var t=u(this),n=t.data("sc_key"),a=b._getTimeLineNumber.apply(p,[e.position.top]);return e.position.left=Math.floor(e.position.left/w.widthTimeX)*w.widthTimeX,c.nowTimeline!==a&&(c.nowTimeline=a),c.currentTop=e.position.top,c.currentLeft=e.position.left,b._rewriteBarText.apply(p,[t,v[n]]),!0},stop:function(){u(this).data("dragCheck",!1),c=null;var i=u(this),e=i.data("sc_key"),t=i.position().left,n=g+Math.floor(t/w.widthTimeX)*w.widthTime,a=n+(v[e].end-v[e].start);v[e].start=n,v[e].end=a,w.onChange&&w.onChange(i,v[e])}}),l.resizable({handles:"e",grid:[w.widthTimeX,w.timeLineY],minWidth:w.widthTimeX,start:function(){u(this).data("resizeCheck",!0)},stop:function(){var i=u(this),e=i.data("sc_key"),t=i.position().left,n=i.width(),a=g+Math.floor(t/w.widthTimeX)*w.widthTime,d=g+Math.floor((t+n)/w.widthTimeX)*w.widthTime,s=v[e].timeline;v[e].start=a,v[e].end=d,b._resetBarPosition.apply(p,[s]),b._rewriteBarText.apply(p,[i,v[e]]),i.data("resizeCheck",!1),w.onChange&&w.onChange(i,v[e])}}),r},_getScheduleCount:function(i){var e=0;for(var t in v)v[t].timeline===i&&e++;return e},_addRow:function(i,e){var t,n=e.title,a=_.find(".sc_main .timeline").length;t="";var d=u(t+='<div class="timeline"><span>'+n+"</span></div>");w.onInitRow&&w.onInitRow(d,e),_.find(".sc_data_scroll").append(d),t="";for(var s=u(t+='<div class="timeline"></div>'),o=g;o<x;o+=w.widthTime){var r=u('<div class="tl"></div>');r.width(w.widthTimeX-w.timeBorder),r.data("time",b.formatTime(o)),r.data("timeline",i),s.append(r)}if(s.find(".tl").click(function(){w.onScheduleClick&&w.onScheduleClick(this,u(this).data("time"),u(this).data("timeline"),T[u(this).data("timeline")])}),s.find(".tl").on("contextmenu",function(){return w.onScheduleClick&&w.onScheduleClick(this,u(this).data("time"),u(this).data("timeline"),T[u(this).data("timeline")]),!1}),_.find(".sc_main").append(s),(T[i]=e).class&&""!==e.class&&(_.find(".sc_data .timeline").eq(a).addClass(e.class),_.find(".sc_main .timeline").eq(a).addClass(e.class)),e.schedule)for(var l in e.schedule){var c=e.schedule[l],h=b.calcStringTime(c.start),m=b.calcStringTime(c.end),f={};f.start=h,f.end=m,c.text&&(f.text=c.text),f.timeline=l,f.data={},c.data&&(f.data=c.data),b._addScheduleData.apply(p,[a,f])}b._resetBarPosition.apply(p,[a]),_.find(".sc_main .timeline").eq(a).droppable({accept:".sc_bar",drop:function(i,e){var t=e.draggable,n=t.data("sc_key"),a=v[n].timeline,d=_.find(".sc_main .timeline").index(this);v[n].timeline=d,t.appendTo(this),b._resetBarPosition.apply(p,[a]),b._resetBarPosition.apply(p,[d])}}),w.onAppendRow&&_.find(".sc_main .timeline").eq(a).find(".sc_bar").each(function(){var i=u(this),e=i.data("sc_key");w.onAppendRow(i,v[e])})},_rewriteBarText:function(i,e){var t=i.position().left,n=g+Math.floor(t/w.widthTimeX)*w.widthTime,a=n+(e.end-e.start),d=b.formatTime(n)+"-"+b.formatTime(a);u(i).find(".time").html(d)},_resetBarPosition:function(i){var e,t,n,a,d,s,o,r,l=_.find(".sc_main .timeline").eq(i).find(".sc_bar"),c=[],h=[],m=0;for(r=0;r<l.length;r++)c[r]={code:r,x:u(l[r]).position().left};for(c.sort(function(i,e){return i.x<e.x?-1:i.x>e.x?1:0}),r=0;r<c.length;r++){for(n=c[r].code,e=u(l[n]),m=0;m<h.length;m++){for(var f=!1,p=0;p<h[m].length;p++)a=h[m][p],t=u(l[a]),d=e.position().left,o=e.position().left+e.width(),s=t.position().left,d<t.position().left+t.width()&&s<o&&(f=!0);if(!f)break}h[m]||(h[m]=[]),e.css({top:m*w.timeLineY+w.timeLinePaddingTop}),h[m][h[m].length]=n}b._resizeRow.apply(this,[i,h.length])},_resizeRow:function(i,e){var t=Math.max(e,1);_.find(".sc_data .timeline").eq(i).height(t*w.timeLineY-w.timeLineBorder+w.timeLinePaddingTop+w.timeLinePaddingBottom),_.find(".sc_main .timeline").eq(i).height(t*w.timeLineY-w.timeLineBorder+w.timeLinePaddingTop+w.timeLinePaddingBottom),_.find(".sc_main .timeline").eq(i).find(".sc_bgBar").each(function(){u(this).height(u(this).closest(".timeline").height())}),_.find(".sc_data").height(_.find(".sc_main_box").height())},_resizeWindow:function(){var i=_.width()-w.dataWidth-w.verticalScrollbar,e=Math.floor((x-g)/w.widthTime);_.find(".sc_header_cell").width(w.dataWidth),_.find(".sc_data,.sc_data_scroll").width(w.dataWidth),_.find(".sc_header").width(i),_.find(".sc_main_box").width(i),_.find(".sc_header_scroll").width(w.widthTimeX*e),_.find(".sc_main_scroll").width(w.widthTimeX*e)},_moveSchedules:function(i,e,t){for(var n=_.find(".sc_main .timeline").eq(i).find(".sc_bar"),a=0;a<n.length;a++){var d=u(n[a]);if(e.position().left<=d.position().left){var s=d.position().left+w.widthTimeX*t,o=Math.floor((x-g)/w.widthTime)*w.widthTimeX-d.width();d.css({left:Math.max(0,Math.min(s,o))});var r=d.data("sc_key"),l=g+Math.floor(d.position().left/w.widthTimeX)*w.widthTime,c=l+(v[r].end-v[r].start);v[r].start=l,v[r].end=c,b._rewriteBarText.apply(p,[d,v[r]]),w.onChange&&w.onChange(d,v[r])}}b._resetBarPosition.apply(p,[i])},init:function(i){_=u(this),p=this,w=u.extend({className:"jq-schedule",rows:{},startTime:"07:00",endTime:"19:30",widthTimeX:25,widthTime:600,timeLineY:50,timeLineBorder:1,timeBorder:1,timeLinePaddingTop:0,timeLinePaddingBottom:0,headTimeBorder:1,dataWidth:160,verticalScrollbar:0,bundleMoveWidth:1,onInitRow:null,onChange:null,onClick:null,onAppendRow:null,onAppendSchedule:null,onScheduleClick:null},i),g=b.calcStringTime(w.startTime),x=b.calcStringTime(w.endTime),g-=g%w.widthTime,x-=x%w.widthTime;var e='<div class="sc_menu">\n<div class="sc_header_cell"><span>&nbsp;</span></div>\n<div class="sc_header">\n<div class="sc_header_scroll"></div>\n</div>\n<br class="clear" />\n</div>\n<div class="sc_wrapper">\n<div class="sc_data">\n<div class="sc_data_scroll"></div>\n</div>\n<div class="sc_main_box">\n<div class="sc_main_scroll">\n<div class="sc_main"></div>\n</div>\n</div>\n<br class="clear" />\n</div>';_.append(e),_.addClass(w.className),_.find(".sc_main_box").scroll(function(){_.find(".sc_data_scroll").css("top",-1*u(this).scrollTop()),_.find(".sc_header_scroll").css("left",-1*u(this).scrollLeft())});for(var t=-1,n=g;n<x;n+=w.widthTime)if(t<0||Math.floor(t/3600)!==Math.floor(n/3600)){e="",e+='<div class="sc_time">'+b.formatTime(n)+"</div>";var a=u(e),d=Number(Math.min(3600*Math.ceil((n+w.widthTime)/3600),x)-n),s=Math.floor(d/w.widthTime);a.width(s*w.widthTimeX-w.headTimeBorder),_.find(".sc_header_scroll").append(a),t=n}for(var o in u(window).resize(function(){b._resizeWindow.apply(p)}).trigger("resize"),w.rows)b._addRow.apply(this,[o,w.rows[o]]);return this}};u.fn.timeSchedule=function(i){return b[i]?b[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(u.error("Method "+i+" does not exist on jQuery.timeSchedule"),this):b.init.apply(this,arguments)}}(jQuery);
//# sourceMappingURL=jq.schedule.min.js.map
