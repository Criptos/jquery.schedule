!function(u){"use strict";var v,p,_=null,T=[],w=[],h=null,g=0,b=0,x={calcStringTime:function(i){var e=i.split(":");return 60*Number(e[0])*60+60*Number(e[1])},formatTime:function(i){return""+(i/36e3|0)+(i/3600%10|0)+":"+(""+(i%3600/600|0)+(i%3600/60%10|0))},getTimelineData:function(){return w},getTimeLineNumber:function(i){var e=0,t=0,a=Math.ceil(i/(_.timeLineY+_.timeLinePaddingTop+_.timeLinePaddingBottom));for(var n in _.rows){var d=_.rows[n],s=0;if("object"==typeof d.schedule&&(s=d.schedule.length),h&&h.timeline&&s++,a<=(t+=Math.max(s,1)))break;e++}return e},addScheduleBgData:function(i){var e=Math.ceil((i.start-g)/_.widthTime),t=Math.floor((i.end-g)/_.widthTime),a=u('<div class="sc_bgBar"><span class="text"></span></div>');a.css({left:e*_.widthTimeX,top:0,width:(t-e)*_.widthTimeX,height:v.find(".sc_main .timeline").eq(i.timeline).height()}),i.text&&a.find(".text").text(i.text),i.class&&a.addClass(i.class),v.find(".sc_main .timeline").eq(i.timeline).append(a)},addScheduleData:function(i,e){var t=Math.ceil((e.start-g)/_.widthTime),a=Math.floor((e.end-g)/_.widthTime),n=u('<div class="sc_bar"><span class="head"><span class="time"></span></span><span class="text"></span></div>'),d=x.formatTime(e.start),s=x.formatTime(e.end),r=x.getScheduleCount.apply(p,[e.timeline]);n.css({left:t*_.widthTimeX,top:r*_.timeLineY+_.timeLinePaddingTop,width:(a-t)*_.widthTimeX,height:_.timeLineY}),n.find(".time").text(d+"-"+s),e.text&&n.find(".text").text(e.text),e.class&&n.addClass(e.class);var l=v.find(".sc_main .timeline").eq(i);l.append(n),T.push(e),_.append_schedule&&_.append_schedule(l,e);var o=T.length-1;n.data("sc_key",o),n.bind("mouseup",function(){if(_.click&&!0!==u(this).data("dragCheck")&&!0!==u(this).data("resizeCheck")){var i=u(this),e=i.data("sc_key");_.click(i,T[e])}});var c=v.find(".sc_bar");return c.draggable({grid:[_.widthTimeX,1],containment:".sc_main",helper:"original",start:function(i,e){var t={};t.node=this,t.offsetTop=e.position.top,t.offsetLeft=e.position.left,t.currentTop=e.position.top,t.currentLeft=e.position.left,t.timeline=x.getTimeLineNumber.apply(p,[e.position.top]),t.nowTimeline=t.timeline,h=t},drag:function(i,e){if(u(this).data("dragCheck",!0),!h)return!1;var t=u(this),a=t.data("sc_key"),n=x.getTimeLineNumber.apply(p,[e.position.top]);return e.position.left=Math.floor(e.position.left/_.widthTimeX)*_.widthTimeX,h.nowTimeline!==n&&(h.nowTimeline=n),h.currentTop=e.position.top,h.currentLeft=e.position.left,x.rewriteBarText.apply(p,[t,T[a]]),!0},stop:function(){u(this).data("dragCheck",!1),h=null;var i=u(this),e=i.data("sc_key"),t=i.position().left,a=g+Math.floor(t/_.widthTimeX)*_.widthTime,n=a+(T[e].end-T[e].start);T[e].start=a,T[e].end=n,_.change&&_.change(i,T[e])}}),c.resizable({handles:"e",grid:[_.widthTimeX,_.timeLineY],minWidth:_.widthTimeX,start:function(){u(this).data("resizeCheck",!0)},stop:function(){var i=u(this),e=i.data("sc_key"),t=i.position().left,a=i.width(),n=g+Math.floor(t/_.widthTimeX)*_.widthTime,d=g+Math.floor((t+a)/_.widthTimeX)*_.widthTime,s=T[e].timeline;T[e].start=n,T[e].end=d,x.resetBarPosition.apply(p,[s]),x.rewriteBarText.apply(p,[i,T[e]]),i.data("resizeCheck",!1),_.change&&_.change(i,T[e])}}),o},getScheduleCount:function(i){var e=0;for(var t in T)T[t].timeline===i&&e++;return e},addRow:function(i,e){var t,a=e.title,n=v.find(".sc_main .timeline").length;t="";var d=u(t+='<div class="timeline"><span>'+a+"</span></div>");_.init_data&&_.init_data(d,e),v.find(".sc_data_scroll").append(d),t="";for(var s=u(t+='<div class="timeline"></div>'),r=g;r<b;r+=_.widthTime){var l=u('<div class="tl"></div>');l.width(_.widthTimeX-_.timeBorder),l.data("time",x.formatTime(r)),l.data("timeline",i),s.append(l)}if(s.find(".tl").click(function(){_.time_click&&_.time_click(this,u(this).data("time"),u(this).data("timeline"),w[u(this).data("timeline")])}),s.find(".tl").on("contextmenu",function(){return _.time_click&&_.time_click(this,u(this).data("time"),u(this).data("timeline"),w[u(this).data("timeline")]),!1}),v.find(".sc_main").append(s),(w[i]=e).class&&""!==e.class&&(v.find(".sc_data .timeline").eq(n).addClass(e.class),v.find(".sc_main .timeline").eq(n).addClass(e.class)),e.schedule)for(var o in e.schedule){var c=e.schedule[o],h=x.calcStringTime(c.start),m=x.calcStringTime(c.end),f={};f.start=h,f.end=m,c.text&&(f.text=c.text),f.data={},c.data&&(f.data=c.data),x.addScheduleData.apply(p,[n,f])}x.resetBarPosition.apply(p,[n]),v.find(".sc_main .timeline").eq(n).droppable({accept:".sc_bar",drop:function(i,e){var t=e.draggable,a=t.data("sc_key"),n=T[a].timeline,d=v.find(".sc_main .timeline").index(this);T[a].timeline=d,t.appendTo(this),x.resetBarPosition.apply(p,[n]),x.resetBarPosition.apply(p,[d])}}),_.append&&v.find(".sc_main .timeline").eq(n).find(".sc_bar").each(function(){var i=u(this),e=i.data("sc_key");_.append(i,T[e])})},getScheduleData:function(){var i,e=[];for(i in w)if(void 0!==w[i]){var t=u.extend(!0,{},w[i]);t.schedule=[],e.push(t)}for(i in T)if(void 0!==T[i]){var a=u.extend(!0,{},T[i]),n=a.timeline;delete a.timeline,a.start=x.formatTime(a.start),a.end=x.formatTime(a.end),e[n].schedule.push(a)}return e},rewriteBarText:function(i,e){var t=i.position().left,a=g+Math.floor(t/_.widthTimeX)*_.widthTime,n=a+(e.end-e.start),d=x.formatTime(a)+"-"+x.formatTime(n);u(i).find(".time").html(d)},resetBarPosition:function(i){var e,t,a,n,d,s,r,l,o=v.find(".sc_main .timeline").eq(i).find(".sc_bar"),c=[],h=[],m=0;for(l=0;l<o.length;l++)c[l]={code:l,x:u(o[l]).position().left};for(c.sort(function(i,e){return i.x<e.x?-1:i.x>e.x?1:0}),l=0;l<c.length;l++){for(a=c[l].code,e=u(o[a]),m=0;m<h.length;m++){for(var f=!1,p=0;p<h[m].length;p++)n=h[m][p],t=u(o[n]),d=e.position().left,r=e.position().left+e.width(),s=t.position().left,d<t.position().left+t.width()&&s<r&&(f=!0);if(!f)break}h[m]||(h[m]=[]),e.css({top:m*_.timeLineY+_.timeLinePaddingTop}),h[m][h[m].length]=a}x.resizeRow.apply(this,[i,h.length])},resizeRow:function(i,e){var t=Math.max(e,1);v.find(".sc_data .timeline").eq(i).height(t*_.timeLineY-_.timeLineBorder+_.timeLinePaddingTop+_.timeLinePaddingBottom),v.find(".sc_main .timeline").eq(i).height(t*_.timeLineY-_.timeLineBorder+_.timeLinePaddingTop+_.timeLinePaddingBottom),v.find(".sc_main .timeline").eq(i).find(".sc_bgBar").each(function(){u(this).height(u(this).closest(".timeline").height())}),v.find(".sc_data").height(v.find(".sc_main_box").height())},resizeWindow:function(){var i=v.width()-_.dataWidth-_.verticalScrollbar,e=Math.floor((b-g)/_.widthTime);v.find(".sc_header_cell").width(_.dataWidth),v.find(".sc_data,.sc_data_scroll").width(_.dataWidth),v.find(".sc_header").width(i),v.find(".sc_main_box").width(i),v.find(".sc_header_scroll").width(_.widthTimeX*e),v.find(".sc_main_scroll").width(_.widthTimeX*e)},moveSchedules:function(i,e,t){for(var a=v.find(".sc_main .timeline").eq(i).find(".sc_bar"),n=0;n<a.length;n++){var d=u(a[n]);if(e.position().left<=d.position().left){var s=d.position().left+_.widthTimeX*t,r=Math.floor((b-g)/_.widthTime)*_.widthTimeX-d.width();d.css({left:Math.max(0,Math.min(s,r))});var l=d.data("sc_key"),o=g+Math.floor(d.position().left/_.widthTimeX)*_.widthTime,c=o+(T[l].end-T[l].start);T[l].start=o,T[l].end=c,x.rewriteBarText.apply(p,[d,T[l]]),_.change&&_.change(d,T[l])}}x.resetBarPosition.apply(p,[i])},init:function(i){v=u(this),p=this,_=u.extend({className:"jq-schedule",rows:{},startTime:"07:00",endTime:"19:30",widthTimeX:25,widthTime:600,timeLineY:50,timeLineBorder:1,timeBorder:1,timeLinePaddingTop:0,timeLinePaddingBottom:0,headTimeBorder:1,dataWidth:160,verticalScrollbar:0,bundleMoveWidth:1,init_data:null,change:null,click:null,append:null,append_schedule:null,time_click:null,debug:""},i),g=x.calcStringTime(_.startTime),b=x.calcStringTime(_.endTime),g-=g%_.widthTime,b-=b%_.widthTime;var e='<div class="sc_menu">\n<div class="sc_header_cell"><span>&nbsp;</span></div>\n<div class="sc_header">\n<div class="sc_header_scroll"></div>\n</div>\n<br class="clear" />\n</div>\n<div class="sc_wrapper">\n<div class="sc_data">\n<div class="sc_data_scroll"></div>\n</div>\n<div class="sc_main_box">\n<div class="sc_main_scroll">\n<div class="sc_main"></div>\n</div>\n</div>\n<br class="clear" />\n</div>';v.append(e),v.addClass(_.className),v.find(".sc_main_box").scroll(function(){v.find(".sc_data_scroll").css("top",-1*u(this).scrollTop()),v.find(".sc_header_scroll").css("left",-1*u(this).scrollLeft())});for(var t=-1,a=g;a<b;a+=_.widthTime)if(t<0||Math.floor(t/3600)!==Math.floor(a/3600)){e="",e+='<div class="sc_time">'+x.formatTime(a)+"</div>";var n=u(e),d=Number(Math.min(3600*Math.ceil((a+_.widthTime)/3600),b)-a),s=Math.floor(d/_.widthTime);n.width(s*_.widthTimeX-_.headTimeBorder),v.find(".sc_header_scroll").append(n),t=a}for(var r in u(window).resize(function(){x.resizeWindow.apply(p)}).trigger("resize"),_.rows)x.addRow.apply(this,[r,_.rows[r]]);_.debug&&""!==_.debug&&setInterval(function(){x.debug.apply(p)},10)},debug:function(){var i="";for(var e in T){i+="<div>",i+=e+" : ";var t=T[e];for(var a in t){i+=a+" "+t[a]}i+="</div>"}u(_.debug).html(i)}};u.fn.timeSchedule=function(i){return x[i]?x[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(u.error("Method "+i+" does not exist on jQuery.timeSchedule"),this):x.init.apply(this,arguments)}}(jQuery);
//# sourceMappingURL=jq.schedule.min.js.map
